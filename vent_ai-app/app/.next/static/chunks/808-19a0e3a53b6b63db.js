"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[808],{4047:function(e,t,n){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(7378),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useState,l=r.useEffect,i=r.useLayoutEffect,s=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!a(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),a=r[0].inst,u=r[1];return i(function(){a.value=n,a.getSnapshot=t,c(a)&&u({inst:a})},[e,n,t]),l(function(){return c(a)&&u({inst:a}),e(function(){c(a)&&u({inst:a})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},644:function(e,t,n){e.exports=n(4047)},2808:function(e,t,n){let r;n.d(t,{RJ:function(){return ev}});var a=n(7378),o=n(644);let l=()=>{},i=l(),s=Object,c=e=>e===i,u=e=>"function"==typeof e,d=(e,t)=>({...e,...t}),f=e=>u(e.then),p=new WeakMap,g=0,y=e=>{let t,n;let r=typeof e,a=e&&e.constructor,o=a==Date;if(s(e)!==e||o||a==RegExp)t=o?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=p.get(e))return t;if(t=++g+"~",p.set(e,t),a==Array){for(n=0,t="@";n<e.length;n++)t+=y(e[n])+",";p.set(e,t)}if(a==s){t="#";let r=s.keys(e).sort();for(;!c(n=r.pop());)c(e[n])||(t+=n+":"+y(e[n])+",");p.set(e,t)}}return t},m=new WeakMap,_={},h={},w="undefined",v=typeof window!=w,b=typeof document!=w,E=()=>v&&typeof window.requestAnimationFrame!=w,x=(e,t)=>{let n=m.get(e);return[()=>!c(t)&&e.get(t)||_,r=>{if(!c(t)){let a=e.get(t);t in h||(h[t]=a),n[5](t,d(a,r),a||_)}},n[6],()=>!c(t)&&t in h?h[t]:!c(t)&&e.get(t)||_]},R=!0,[T,S]=v&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[l,l],k={initFocus:e=>(b&&document.addEventListener("visibilitychange",e),T("focus",e),()=>{b&&document.removeEventListener("visibilitychange",e),S("focus",e)}),initReconnect:e=>{let t=()=>{R=!0,e()},n=()=>{R=!1};return T("online",t),T("offline",n),()=>{S("online",t),S("offline",n)}}},C=!a.useId,O=!v||"Deno"in window,A=e=>E()?window.requestAnimationFrame(e):setTimeout(e,1),V=O?a.useEffect:a.useLayoutEffect,I="undefined"!=typeof navigator&&navigator.connection,j=!O&&I&&(["slow-2g","2g"].includes(I.effectiveType)||I.saveData),D=e=>{if(u(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?y(e):"",t]},L=0,N=()=>++L;var F={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function M(...e){let[t,n,r,a]=e,o=d({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{}),l=o.populateCache,s=o.rollbackOnError,p=o.optimisticData,g=!1!==o.revalidate,y=e=>"function"==typeof s?s(e):!1!==s,_=o.throwOnError;if(u(n)){let e=[];for(let r of t.keys())!/^\$(inf|sub)\$/.test(r)&&n(t.get(r)._k)&&e.push(r);return Promise.all(e.map(h))}return h(n);async function h(n){let a;let[o]=D(n);if(!o)return;let[s,d]=x(t,o),[h,w,v,b]=m.get(t),E=h[o],R=()=>g&&(delete v[o],delete b[o],E&&E[0])?E[0](2).then(()=>s().data):s().data;if(e.length<3)return R();let T=r,S=N();w[o]=[S,0];let k=!c(p),C=s(),O=C.data,A=C._c,V=c(A)?O:A;if(k&&d({data:p=u(p)?p(V,O):p,_c:V}),u(T))try{T=T(V)}catch(e){a=e}if(T&&f(T)){if(T=await T.catch(e=>{a=e}),S!==w[o][0]){if(a)throw a;return T}a&&k&&y(a)&&(l=!0,d({data:T=V,_c:i}))}l&&!a&&(u(l)&&(T=l(T,V)),d({data:T,error:i,_c:i})),w[o][1]=N();let I=await R();if(d({_c:i}),a){if(_)throw a;return}return l?I:T}}let P=(e,t)=>{for(let n in e)e[n][0]&&e[n][0](t)},U=(e,t)=>{if(!m.has(e)){let n=d(k,t),r={},a=M.bind(i,e),o=l,s={},c=(e,t)=>{let n=s[e]||[];return s[e]=n,n.push(t),()=>n.splice(n.indexOf(t),1)},u=(t,n,r)=>{e.set(t,n);let a=s[t];if(a)for(let e of a)e(n,r)},f=()=>{if(!m.has(e)&&(m.set(e,[r,{},{},{},a,u,c]),!O)){let t=n.initFocus(setTimeout.bind(i,P.bind(i,r,0))),a=n.initReconnect(setTimeout.bind(i,P.bind(i,r,1)));o=()=>{t&&t(),a&&a(),m.delete(e)}}};return f(),[e,a,f,o]}return[e,m.get(e)[4]]},[J,W]=U(new Map),q=d({onLoadingSlow:l,onSuccess:l,onError:l,onErrorRetry:(e,t,n,r,a)=>{let o=n.errorRetryCount,l=a.retryCount,i=~~((Math.random()+.5)*(1<<(l<8?l:8)))*n.errorRetryInterval;(c(o)||!(l>o))&&setTimeout(r,i,a)},onDiscarded:l,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:j?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:j?5e3:3e3,compare:(e,t)=>y(e)==y(t),isPaused:()=>!1,cache:J,mutate:W,fallback:{}},{isOnline:()=>R,isVisible:()=>{let e=b&&document.visibilityState;return c(e)||"hidden"!==e}}),$=(e,t)=>{let n=d(e,t);if(t){let{use:r,fallback:a}=e,{use:o,fallback:l}=t;r&&o&&(n.use=r.concat(o)),a&&l&&(n.fallback=d(a,l))}return n},B=(0,a.createContext)({}),z=v&&window.__SWR_DEVTOOLS_USE__,G=z?window.__SWR_DEVTOOLS_USE__:[],H=e=>u(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],K=()=>d(q,(0,a.useContext)(B)),Q=G.concat(e=>(t,n,r)=>{let a=n&&((...e)=>{let[r]=D(t),[,,,a]=m.get(J),o=a[r];return c(o)?n(...e):(delete a[r],o)});return e(t,a,r)}),X=(e,t,n)=>{let r=t[e]||(t[e]=[]);return r.push(n),()=>{let e=r.indexOf(n);e>=0&&(r[e]=r[r.length-1],r.pop())}};z&&(window.__SWR_DEVTOOLS_REACT__=a);let Y=a.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),Z={dedupe:!0};s.defineProperty(e=>{let{value:t}=e,n=(0,a.useContext)(B),r=u(t),o=(0,a.useMemo)(()=>r?t(n):t,[r,n,t]),l=(0,a.useMemo)(()=>r?o:$(n,o),[r,n,o]),s=o&&o.provider,c=(0,a.useRef)(i);s&&!c.current&&(c.current=U(s(l.cache||J),o));let f=c.current;return f&&(l.cache=f[0],l.mutate=f[1]),V(()=>{if(f)return f[2]&&f[2](),f[3]},[]),(0,a.createElement)(B.Provider,d(e,{value:l}))},"defaultValue",{value:q});let ee=(r=(e,t,n)=>{let{cache:r,compare:l,suspense:s,fallbackData:f,revalidateOnMount:p,revalidateIfStale:g,refreshInterval:y,refreshWhenHidden:_,refreshWhenOffline:h,keepPreviousData:w}=n,[v,b,E,R]=m.get(r),[T,S]=D(e),k=(0,a.useRef)(!1),I=(0,a.useRef)(!1),j=(0,a.useRef)(T),L=(0,a.useRef)(t),P=(0,a.useRef)(n),U=()=>P.current,J=()=>U().isVisible()&&U().isOnline(),[W,q,$,B]=x(r,T),z=(0,a.useRef)({}).current,G=c(f)?n.fallback[T]:f,H=(e,t)=>{for(let n in z)if("data"===n){if(!l(e[n],t[n])&&(!c(e[n])||!l(el,t[n])))return!1}else if(t[n]!==e[n])return!1;return!0},K=(0,a.useMemo)(()=>{let e=!!T&&!!t&&(c(p)?!U().isPaused()&&!s&&(!!c(g)||g):p),n=t=>{let n=d(t);return(delete n._k,e)?{isValidating:!0,isLoading:!0,...n}:n},r=W(),a=B(),o=n(r),l=r===a?o:n(a),i=o;return[()=>{let e=n(W());return H(e,i)?(i.data=e.data,i.isLoading=e.isLoading,i.isValidating=e.isValidating,i.error=e.error,i):(i=e,e)},()=>l]},[r,T]),Q=(0,o.useSyncExternalStore)((0,a.useCallback)(e=>$(T,(t,n)=>{H(n,t)||e()}),[r,T]),K[0],K[1]),ee=!k.current,et=v[T]&&v[T].length>0,en=Q.data,er=c(en)?G:en,ea=Q.error,eo=(0,a.useRef)(er),el=w?c(en)?eo.current:en:er,ei=(!et||!!c(ea))&&(ee&&!c(p)?p:!U().isPaused()&&(s?!c(er)&&g:c(er)||g)),es=!!(T&&t&&ee&&ei),ec=c(Q.isValidating)?es:Q.isValidating,eu=c(Q.isLoading)?es:Q.isLoading,ed=(0,a.useCallback)(async e=>{let t,r;let a=L.current;if(!T||!a||I.current||U().isPaused())return!1;let o=!0,s=e||{},d=!E[T]||!s.dedupe,f=()=>C?!I.current&&T===j.current&&k.current:T===j.current,p={isValidating:!1,isLoading:!1},g=()=>{q(p)},y=()=>{let e=E[T];e&&e[1]===r&&delete E[T]},m={isValidating:!0};c(W().data)&&(m.isLoading=!0);try{if(d&&(q(m),n.loadingTimeout&&c(W().data)&&setTimeout(()=>{o&&f()&&U().onLoadingSlow(T,n)},n.loadingTimeout),E[T]=[a(S),N()]),[t,r]=E[T],t=await t,d&&setTimeout(y,n.dedupingInterval),!E[T]||E[T][1]!==r)return d&&f()&&U().onDiscarded(T),!1;p.error=i;let e=b[T];if(!c(e)&&(r<=e[0]||r<=e[1]||0===e[1]))return g(),d&&f()&&U().onDiscarded(T),!1;let s=W().data;p.data=l(s,t)?s:t,d&&f()&&U().onSuccess(t,T,n)}catch(n){y();let e=U(),{shouldRetryOnError:t}=e;!e.isPaused()&&(p.error=n,d&&f()&&(e.onError(n,T,e),(!0===t||u(t)&&t(n))&&J()&&e.onErrorRetry(n,T,e,e=>{let t=v[T];t&&t[0]&&t[0](F.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return o=!1,g(),!0},[T,r]),ef=(0,a.useCallback)((...e)=>M(r,j.current,...e),[]);if(V(()=>{L.current=t,P.current=n,c(en)||(eo.current=en)}),V(()=>{if(!T)return;let e=ed.bind(i,Z),t=0,n=X(T,v,(n,r={})=>{if(n==F.FOCUS_EVENT){let n=Date.now();U().revalidateOnFocus&&n>t&&J()&&(t=n+U().focusThrottleInterval,e())}else if(n==F.RECONNECT_EVENT)U().revalidateOnReconnect&&J()&&e();else if(n==F.MUTATE_EVENT)return ed();else if(n==F.ERROR_REVALIDATE_EVENT)return ed(r)});return I.current=!1,j.current=T,k.current=!0,q({_k:S}),ei&&(c(er)||O?e():A(e)),()=>{I.current=!0,n()}},[T]),V(()=>{let e;function t(){let t=u(y)?y(W().data):y;t&&-1!==e&&(e=setTimeout(n,t))}function n(){!W().error&&(_||U().isVisible())&&(h||U().isOnline())?ed(Z).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[y,_,h,T]),(0,a.useDebugValue)(el),s&&c(er)&&T){if(!C&&O)throw Error("Fallback data is required when using suspense in SSR.");L.current=t,P.current=n,I.current=!1;let e=R[T];if(c(e)||Y(ef(e)),c(ea)){let e=ed(Z);c(el)||(e.status="fulfilled",e.value=!0),Y(e)}else throw ea}return{mutate:ef,get data(){return z.data=!0,el},get error(){return z.error=!0,ea},get isValidating(){return z.isValidating=!0,ec},get isLoading(){return z.isLoading=!0,eu}}},function(...e){let t=K(),[n,a,o]=H(e),l=$(t,o),i=r,{use:s}=l,c=(s||[]).concat(Q);for(let e=c.length;e--;)i=c[e](i);return i(n,a||l.fetcher||null,l)});var et={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},en={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},er={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},ea={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},eo={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},el={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},ei={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},es={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},ec={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},eu={[et.code]:et,[en.code]:en,[er.code]:er,[ea.code]:ea,[eo.code]:eo,[el.code]:el,[ei.code]:ei,[es.code]:es,[ec.code]:ec};et.name,et.code,en.name,en.code,er.name,er.code,ea.name,ea.code,eo.name,eo.code,el.name,el.code,ei.name,ei.code,es.name,es.code,ec.name,ec.code;var ed=[et,en,er,ea,eo,el,ei,es,ec].map(e=>e.code),ef=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let n=e.slice(0,t);if(!ed.includes(n))throw Error(`Failed to parse stream string. Invalid code ${n}.`);let r=JSON.parse(e.slice(t+1));return eu[n].parse(r)};async function*ep(e,{isAborted:t}={}){let n=new TextDecoder,r=[],a=0;for(;;){let{value:o}=await e.read();if(o&&(r.push(o),a+=o.length,10!==o[o.length-1]))continue;if(0===r.length)break;let l=function(e,t){let n=new Uint8Array(t),r=0;for(let t of e)n.set(t,r),r+=t.length;return e.length=0,n}(r,a);for(let e of(a=0,n.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(ef)))yield e;if(null==t?void 0:t()){e.cancel();break}}}var eg=((e,t=21)=>(n=t)=>{let r="",a=n;for(;a--;)r+=e[Math.random()*e.length|0];return r})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function ey(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function em({reader:e,abortControllerRef:t,update:n,onFinish:r,generateId:a=eg,getCurrentDate:o=()=>new Date}){let l;let i=o(),s={data:[]};for await(let{type:r,value:o}of ep(e,{isAborted:()=>(null==t?void 0:t.current)===null})){"text"===r&&(s.text?s.text={...s.text,content:(s.text.content||"")+o}:s.text={id:a(),role:"assistant",content:o,createdAt:i});let e=null;"function_call"===r&&(s.function_call={id:a(),role:"assistant",content:"",function_call:o.function_call,name:o.function_call.name,createdAt:i},e=s.function_call);let t=null;"tool_calls"===r&&(s.tool_calls={id:a(),role:"assistant",content:"",tool_calls:o.tool_calls,createdAt:i},t=s.tool_calls),"data"===r&&s.data.push(...o);let c=s.text;"message_annotations"===r&&(l?l.push(...o):l=[...o],e=ey(s.function_call,l),t=ey(s.tool_calls,l),c=ey(s.text,l)),(null==l?void 0:l.length)&&["text","function_call","tool_calls"].forEach(e=>{s[e]&&(s[e].annotations=[...l])}),n([e,t,c].filter(Boolean).map(e=>({...ey(e,l)})),[...s.data])}return null==r||r(s),{messages:[s.text,s.function_call,s.tool_calls].filter(Boolean),data:s.data}}async function e_({api:e,messages:t,body:n,streamMode:r="stream-data",credentials:a,headers:o,abortController:l,restoreMessagesOnFailure:i,onResponse:s,onUpdate:c,onFinish:u,generateId:d}){var f;let p=await fetch(e,{method:"POST",body:JSON.stringify({messages:t,...n}),headers:{"Content-Type":"application/json",...o},signal:null==(f=null==l?void 0:l())?void 0:f.signal,credentials:a}).catch(e=>{throw i(),e});if(s)try{await s(p)}catch(e){throw e}if(!p.ok)throw i(),Error(await p.text()||"Failed to fetch the chat response.");if(!p.body)throw Error("The response body is empty.");let g=p.body.getReader();switch(r){case"text":{let e=function(e){let t=new TextDecoder;return function(e){return e?t.decode(e,{stream:!0}):""}}(),t={id:d(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:n,value:r}=await g.read();if(n)break;if(t.content+=e(r),t.id=d(),c([{...t}],[]),(null==l?void 0:l())===null){g.cancel();break}}return null==u||u(t),{messages:[t],data:[]}}case"stream-data":return await em({reader:g,abortControllerRef:null!=l?{current:l()}:void 0,update:c,onFinish(e){u&&null!=e.text&&u(e.text)},generateId:d});default:throw Error(`Unknown stream mode: ${r}`)}}async function eh({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:n,updateChatRequest:r,getCurrentMessages:a}){for(;;){let o=await e();if("messages"in o){let e=!1;for(let l of o.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(e=!0,t){let n=l.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let o=await t(a(),n);if(void 0===o){e=!1;break}r(o)}if(n){let t=l.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let o=await n(a(),t);if(void 0===o){e=!1;break}r(o)}}if(!e)break}else{let e=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===o.function_call||"string"==typeof o.function_call)&&(void 0===o.tool_calls||"string"==typeof o.tool_calls))break;if(t){let n=o.function_call;if("object"!=typeof n){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await t(a(),n);if(void 0===l)break;e(l),r(l)}if(n){let t=o.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await n(a(),t);if(void 0===l)break;e(l),r(l)}}}}var ew=async(e,t,n,r,a,o,l,i,s,c,u,d,f)=>{var p,g;let y=l.current;n(t.messages,!1);let m=f?t.messages:t.messages.map(({role:e,content:t,name:n,function_call:r,tool_calls:a,tool_call_id:o})=>({role:e,content:t,tool_call_id:o,...void 0!==n&&{name:n},...void 0!==r&&{function_call:r},...void 0!==a&&{tool_calls:a}}));if("string"!=typeof e){let r={id:s(),createdAt:new Date,content:"",role:"assistant"};async function _(e){let{content:a,ui:o,next:l}=await e;r.content=a,r.ui=await o,n([...t.messages,{...r}],!1),l&&await _(l)}try{let n=e({messages:m,data:t.data});await _(n)}catch(e){throw n(y,!1),e}return u&&u(r),r}return await e_({api:e,messages:m,body:{data:t.data,...o.current.body,...null==(p=t.options)?void 0:p.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamMode:c,credentials:o.current.credentials,headers:{...o.current.headers,...null==(g=t.options)?void 0:g.headers},abortController:()=>i.current,restoreMessagesOnFailure(){n(y,!1)},onResponse:d,onUpdate(e,o){n([...t.messages,...e],!1),r([...a||[],...o||[]],!1)},onFinish:u,generateId:s})};function ev({api:e="/api/chat",id:t,initialMessages:n,initialInput:r="",sendExtraMessageFields:o,experimental_onFunctionCall:l,experimental_onToolCall:i,streamMode:s,onResponse:c,onFinish:u,onError:d,credentials:f,headers:p,body:g,generateId:y=eg}={}){let m=(0,a.useId)(),_=null!=t?t:m,h="string"==typeof e?[e,_]:_,[w]=(0,a.useState)([]),{data:v,mutate:b}=ee([h,"messages"],null,{fallbackData:null!=n?n:w}),{data:E=!1,mutate:x}=ee([h,"loading"],null),{data:R,mutate:T}=ee([h,"streamData"],null),{data:S,mutate:k}=ee([h,"error"],null),C=(0,a.useRef)(v||[]);(0,a.useEffect)(()=>{C.current=v||[]},[v]);let O=(0,a.useRef)(null),A=(0,a.useRef)({credentials:f,headers:p,body:g});(0,a.useEffect)(()=>{A.current={credentials:f,headers:p,body:g}},[f,p,g]);let V=(0,a.useCallback)(async t=>{try{x(!0),k(void 0);let n=new AbortController;O.current=n,await eh({getStreamedResponse:()=>ew(e,t,b,T,R,A,C,O,y,s,u,c,o),experimental_onFunctionCall:l,experimental_onToolCall:i,updateChatRequest:e=>{t=e},getCurrentMessages:()=>C.current}),O.current=null}catch(e){if("AbortError"===e.name)return O.current=null,null;d&&e instanceof Error&&d(e),k(e)}finally{x(!1)}},[b,x,e,A,c,u,d,k,T,R,o,l,i,C,O,y]),I=(0,a.useCallback)(async(e,{options:t,functions:n,function_call:r,tools:a,tool_choice:o,data:l}={})=>(e.id||(e.id=y()),V({messages:C.current.concat(e),options:t,data:l,...void 0!==n&&{functions:n},...void 0!==r&&{function_call:r},...void 0!==a&&{tools:a},...void 0!==o&&{tool_choice:o}})),[V,y]),j=(0,a.useCallback)(async({options:e,functions:t,function_call:n,tools:r,tool_choice:a}={})=>0===C.current.length?null:"assistant"===C.current[C.current.length-1].role?V({messages:C.current.slice(0,-1),options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==r&&{tools:r},...void 0!==a&&{tool_choice:a}}):V({messages:C.current,options:e,...void 0!==t&&{functions:t},...void 0!==n&&{function_call:n},...void 0!==r&&{tools:r},...void 0!==a&&{tool_choice:a}}),[V]),D=(0,a.useCallback)(()=>{O.current&&(O.current.abort(),O.current=null)},[]),L=(0,a.useCallback)(e=>{b(e,!1),C.current=e},[b]),[N,F]=(0,a.useState)(r),M=(0,a.useCallback)((e,t={},n)=>{n&&(A.current={...A.current,...n}),e.preventDefault(),N&&(I({content:N,role:"user",createdAt:new Date},t),F(""))},[N,I]);return{messages:v||[],error:S,append:I,reload:j,stop:D,setMessages:L,input:N,setInput:F,handleInputChange:e=>{F(e.target.value)},handleSubmit:M,isLoading:E,data:R}}}}]);